<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:fragment="head">
    <meta charset="UTF-8">
    <title>Nidas</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@700;800&family=Noto+Sans+KR:wght@500;700&family=Noto+Sans:wght@400;700&family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/public/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/node_modules/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/css/common.css">
</head>

<div th:fragment="main-nav" class="main-nav">
    <nav class="navbar navbar-light justify-content-between navbar-expand">
        <a th:href="@{'/'}" class="navbar-brand">
            <img src="/images/logo.png" width="90" height="36" alt="&times;" />
        </a>
        <ul class="navbar-nav ms-auto justify-content-end w-100 user-menu">
            <li class="nav-item" sec:authorize="!isAuthenticated()">
                <a class="nav-link" th:href="@{'/login'}">
                    <i class="fa fa-sign-in" aria-hidden="true"></i> <span class="main-nav-icon-text">login</span>
                </a>
            </li>
            <li class="nav-item" sec:authorize="!isAuthenticated()">
                <a class="nav-link" th:href="@{'/sign-up'}">
                    <i class="fa fa-user-plus" aria-hidden="true"></i> <span class="main-nav-icon-text">sign up</span>
                </a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <a class="nav-link" th:href="@{'/mypage/edit/info'}">
                    <i class="fa fa-address-book" aria-hidden="true"></i> <span class="main-nav-icon-text">my page</span>
                </a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <a class="nav-link" th:href="@{'/mypage/favorites-list'}">
                    <i class="fa fa-heart" aria-hidden="true"></i> <span class="main-nav-icon-text">my favorites</span>
                </a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <a class="nav-link" th:href="@{'/cart-list'}">
                    <i class="fa fa-shopping-cart" aria-hidden="true"></i> <span class="main-nav-icon-text">shopping bag</span>
                </a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <a class="nav-link position-relative" th:href="@{'/notifications'}">
                    <i th:if="${!hasNotification}" class="fa fa-bell-o" aria-hidden="true"></i>
                    <span th:if="${hasNotification}" class="text-dark">
                        <i class="fa fa-bell" aria-hidden="true"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" th:text="${notificationCountOfNotChecked}"></span>
                    </span>
                    <span class="main-nav-icon-text">notifications</span>
                </a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <form th:action="@{'/logout'}" method="post">
                    <button type="submit" class="btn btn-link nav-link">
                        <i class="fa fa-sign-out" aria-hidden="true"></i> <span class="main-nav-icon-text">logout</span>
                    </button>
                </form>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated() && hasRole('ROLE_ADMIN')">
                <a class="nav-link" th:href="@{'/admin/management/account'}">
                    <i class="fa fa-eye" aria-hidden="true"></i> <span class="main-nav-icon-text">Admin Page</span>
                </a>
            </li>
        </ul>
    </nav>
    <form th:action="@{'/products'}" method="get" class="search-form mx-auto">
        <input id="keywords" name="keywords" class="form-control me-2" type="search" placeholder="상품명을 검색해주세요." aria-label="Search" th:value="${productSearchForm?.keywords}">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
    <nav class="navbar navbar-light navbar-expand-md product-menu mt-3">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".product-menu-content" aria-controls="product-menu-content" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span> 상품 메뉴
        </button>
        <div class="collapse navbar-collapse justify-content-md-center product-menu-content">
            <div class="navbar-nav">
                <div th:each="m : ${T(com.nidas.modules.product.MainCategory).values()}" class="category">
                    <a class="nav-link main-category" th:href="@{'/products?mainCategory=' + ${m}}"><span th:text="${m}"></span></a>
                    <div class="sub-category-list">
                        <a th:each="s : ${T(com.nidas.modules.product.SubCategory).values()}" class="nav-link"
                           th:href="@{'/products?mainCategory=' + ${m} + '&subCategory=' + ${#strings.replace(s.getName(), '&', '%26')}}">
                            <span th:text="${s.getName()}"></span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>

<div th:fragment="main-banner" id="mainBanner" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#mainBanner" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#mainBanner" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#mainBanner" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="/images/main_banner_1.png" class="d-block w-100" alt="&times;">
        </div>
        <div class="carousel-item">
            <img src="/images/main_banner_2.png" class="d-block w-100" alt="&times;">
        </div>
        <div class="carousel-item">
            <img src="/images/main_banner_3.png" class="d-block w-100" alt="&times;">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#mainBanner" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#mainBanner" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<footer th:fragment="main-footer" class="text-center text-md-start bg-light text-muted">
    <section class="d-flex justify-content-center justify-content-md-between p-4 border-bottom">
        <div class="me-5 d-none d-md-block">
            <span>Get connected with us on social networks:</span>
        </div>
        <div>
            <a href="" class="me-4"><i class="fa fa-facebook-f"></i></a>
            <a href="" class="me-4"><i class="fa fa-twitter"></i></a>
            <a href="" class="me-4"><i class="fa fa-google"></i></a>
            <a href="" class="me-4"><i class="fa fa-instagram"></i></a>
            <a href="" class="me-4"><i class="fa fa-linkedin"></i></a>
            <a href="" class="me-4"><i class="fa fa-github"></i></a>
        </div>
    </section>
    <section>
        <div class="mw-100 text-center text-md-start mt-5 px-4">
            <div class="row mt-3">
                <div class="col-md-6 mx-auto mb-4">
                    <h6 class="footer-title">Notice</h6>
                    <ul>
                        <li th:each="n : ${newestNoticeList}" class="mb-2">
                            <a th:href="@{'/notice-list'}">
                                <span th:text="${n.title}"></span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-2 mx-auto mb-4">
                    <h6 class="footer-title">My Order</h6>
                    <p><a th:href="@{'/mypage/order-list'}">주문 내역</a></p>
                    <p><a th:href="@{'/mypage/cancel-returns-list'}">취소/교환/반품 내역</a></p>
                    <p><a th:href="@{'/mypage/review-list'}">리뷰 내역</a></p>
                </div>
                <div class="col-md-2 mx-auto mb-4">
                    <h6 class="footer-title">My Account</h6>
                    <p><a th:href="@{'/mypage/edit/info'}">회원 정보 수정</a></p>
                    <p><a th:href="@{'/mypage/mileage'}">마일리지 조회</a></p>
                    <p><a th:href="@{'/mypage/membership'}">등급 조회</a></p>
                </div>
                <div class="col-md-2 mx-auto mb-4">
                    <h6 class="footer-title">Help</h6>
                    <p><a th:href="@{'/mypage/qna-list'}">Q&A</a></p>
                    <p><a th:href="@{'/faq-list'}">FAQ</a></p>
                    <p><a th:href="@{'/notice-list'}">공지사항</a></p>
                </div>
            </div>
        </div>
    </section>
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
        &copy; Nidas All Rights Reserved
    </div>
</footer>

<div th:fragment="admin-common-js-func">
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
</div>

<div th:fragment="common-js-func">
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script type="application/javascript">
        $(function () {
            const $productMenuContent = $(".product-menu .product-menu-content");
            const $categoryArray = $(".product-menu .category");

            $categoryArray.each(function () {
                $(this).mouseenter(function (e) {
                    if (window.innerWidth >= 768) {
                        $categoryArray.each(function (idx, el) {
                            $(el).find("a.main-category").css('borderBottom', '3px solid transparent');
                        });
                        $(e.currentTarget).find("a.main-category").css('borderBottom', '3px solid #b71c1c'); // 선택된 메뉴만 강조
                    }
                    $(".product-menu .category .sub-category-list").hide();
                    $(e.currentTarget).find(".sub-category-list").show(); // 선택된 메뉴의 하위 메뉴만 보여줌
                });
            });

            $productMenuContent.mouseleave(function () {
                $categoryArray.each(function (idx, el) {
                    $(el).find("a.main-category").css('borderBottom', '3px solid transparent');
                });
                $(".product-menu .category .sub-category-list").hide();
            });
        });
    </script>
</div>

<script th:fragment="price-with-comma" type="application/javascript">
    $(function () {
        formatPrice();
    });
    function formatPrice() {
        const $priceFormat = $('.price-format');
        $priceFormat.each((idx, el) => {
            const $el = $(el);
            $el.text($el.text().replace(/\B(?=(\d{3})+(?!\d))/g, ",")); // \B: 숫자 사이의 경계, 3자리 단위 숫자(3, 6, 9, ...) 이후 숫자가 없는 경우에 매칭
        });
    }
</script>

<script th:fragment="validate-user-info" type="application/javascript">
    function validateEmail(email) {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return regex.test(email);
    }

    function validatePassword(password) {
        const regex = /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*_-])[a-zA-Z0-9!@#$%^&*_-]{8,20}$/;
        return regex.test(password);
    }

    function validateName(name) {
        const regex = /^[a-zA-Z가-힣]{1,30}$/;
        return regex.test(name);
    }

    function validateBirthday(birthday) {
        const regex = /^((19|20)\d{2})-(((0[1-9]|1[0-2])-([0-2][1-9]|10|20))|((0[13-9]|1[0-2])-30)|((0[13578]|10|12)-31))$/;
        return regex.test(birthday);
    }
    
    function validateIfBeforeNow(date) {
        const now = new Date().toJSON().slice(0, 10);
        return now > date;
    }

    function validatePhoneNumber(phoneNumber) {
        const regex = /^(01[016789])([0-9]{3,4})([0-9]{4})$/;
        return regex.test(phoneNumber);
    }
</script>

<div th:fragment="daum-address-api">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="application/javascript">
        function execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    const postcode = document.querySelector("#address1");
                    const address = document.querySelector("#address2");
                    const detailsAddress = document.querySelector("#address3");

                    let addr = ''; // 주소 변수
                    let extraAddress = ''; // 참고항목 변수

                    if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                        addr = data.roadAddress;
                    } else { // 사용자가 지번 주소를 선택했을 경우(J)
                        addr = data.jibunAddress;
                    }

                    if(data.userSelectedType === 'R'){
                        if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                            extraAddress += data.bname;
                        }
                        // 건물명이 있고, 공동주택일 경우 추가한다.
                        if (data.buildingName !== '' && data.apartment === 'Y') {
                            extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
                        }
                        if (extraAddress !== ''){
                            extraAddress = '(' + extraAddress + ') ';
                        }
                        detailsAddress.value = extraAddress;
                    } else {
                        detailsAddress.value = '';
                    }

                    postcode.value = data.zonecode;
                    address.value = addr;
                    detailsAddress.focus();
                }
            }).open();
        }
    </script>
</div>

<div th:fragment="error-message" th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <p class="lead">처리 실패!!</p>
    <span th:text="${errorMessage}" style="white-space: pre-line"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<div th:fragment="success-message" th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
    <p class="lead">성공적으로 처리 완료!!</p>
    <span th:text="${successMessage}" style="white-space: pre-line"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<nav th:fragment="mypage-nav" class="navbar navbar-light mypage-nav">
    <div class="mypage-nav-title">
        <p style="font-size: 1.8rem; margin-bottom: 0.5rem;"><span th:text="${account.name}"></span></p>
        <p><a th:href="@{'/mypage/favorites-list'}">내 즐겨찾기(</a><span class="favorites-count" th:text="${myFavoritesCount}"></span>)</p>
    </div>
    <ul class="navbar-nav">
        <li class="nav-item mypage-nav-title">내 계정 설정</li>
        <li class="nav-item">
            <a th:href="@{'/mypage/edit/info'}" class="nav-link">정보수정</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/mypage/mileage'}" class="nav-link">마일리지 조회</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/mypage/membership'}" class="nav-link">등급 조회</a>
        </li>
    </ul>
    <ul class="navbar-nav">
        <li class="nav-item mypage-nav-title">내 쇼핑 정보</li>
        <li class="nav-item">
            <a th:href="@{'/mypage/order-list'}" class="nav-link">주문 목록</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/mypage/writable-review-list'}" class="nav-link">리뷰 작성 가능한 목록</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/mypage/review-list'}" class="nav-link">리뷰 목록</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/mypage/cancel-returns-list'}" class="nav-link">취소/교환/반품 목록</a>
        </li>
    </ul>
    <ul class="navbar-nav">
        <li class="nav-item mypage-nav-title">도움/공지</li>
        <li class="nav-item">
            <a th:href="@{'/mypage/qna-list'}" class="nav-link">Q&A 내역</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/faq-list'}" class="nav-link">FAQ</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/notice-list'}" class="nav-link">공지사항</a>
        </li>
    </ul>
</nav>

<script th:fragment="ajax-csrf-header" type="application/javascript" th:inline="javascript">
    $(function () {
        var csrfToken = $("meta[name='_csrf']").attr("content");
        var csrfHeader = $("meta[name='_csrf_header']").attr("content");
        $(document).ajaxSend(function (e, xhr, options) {
            xhr.setRequestHeader(csrfHeader, csrfToken);
        });
    });
</script>

<script th:fragment="ajax-feedback-message" type="application/javascript">
    function setFeedback(response) {
        const errorFields = response.responseJSON.validationErrorList;

        if (!errorFields) {
            alert(response.responseJSON.message);
            return;
        }

        let error, field, $field;
        for (let i = 0, length = errorFields.length; i < length; i++) {
            error = errorFields[i];
            field = error['field'];
            if (field.includes('[')) {
                field = field.substring(0, field.indexOf('['));
            }
            $field = $('#' + field);

            if ($field && $field.length > 0) {
                $field.siblings('.invalid-feedback').text(error['message']).css('display', 'block');
            }
        }
    }
</script>

<nav th:fragment="admin-page-sidebar(currentMenu)" class="navbar navbar-light navbar-expand-md admin-page-nav">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".admin-page-menu" aria-controls="adminPageMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span> 관리자 메뉴
    </button>
    <div class="collapse navbar-collapse admin-page-menu">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a th:href="@{'/'}" class="nav-link">홈페이지로 이동</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/account'}" class="nav-link"
                   th:classappend="${currentMenu == 'account'}?active">회원관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/product'}" class="nav-link"
                   th:classappend="${currentMenu == 'product'}?active">상품관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/order'}" class="nav-link"
                   th:classappend="${currentMenu == 'order'}?active">주문관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/review'}" class="nav-link"
                   th:classappend="${currentMenu == 'review'}?active">리뷰관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/returns'}" class="nav-link"
                   th:classappend="${currentMenu == 'returns'}?active">교환/반품관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/qna'}" class="nav-link"
                   th:classappend="${currentMenu == 'qna'}?active">Q&A관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/faq'}" class="nav-link"
                   th:classappend="${currentMenu == 'faq'}?active">FAQ관리</a>
            </li>
            <li class="nav-item">
                <a th:href="@{'/admin/management/notice'}" class="nav-link"
                   th:classappend="${currentMenu == 'notice'}?active">공지사항관리</a>
            </li>
        </ul>
    </div>
</nav>

<div th:fragment="date-format">
    <script src="/node_modules/moment/min/moment-with-locales.min.js"></script>
    <script type="application/javascript">
        $(function () {
            moment.locale('ko');
            $(".date-time").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").format('LLL');
            });
            $(".date").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").format('LL');
            });
            $(".weekday").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").format('dddd');
            });
            $(".time").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").format('LT');
            });
            $(".calendar").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").calendar();
            });
            $(".fromNow").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").fromNow();
            });
            $(".date-weekday-time").text(function(index, dateTime) {
                if (!dateTime) return "없음";
                return moment(dateTime, "YYYY-MM-DD`T`hh:mm").format('LLLL');
            });
        });
    </script>
</div>

<div th:fragment="summernote-editor">
    <link rel="stylesheet" href="/node_modules/summernote/dist/summernote-bs4.css" />
    <script src="/node_modules/summernote/dist/summernote-bs4.js"></script>
    <script type="application/javascript">
        $(function () {
            $('.editor').summernote({
                fontName: ['Nanum Gothic', 'Noto Sans KR', 'Noto Sans', 'Roboto' , 'Arial', 'sans-serif'],
                tabSize: 4,
                width: 1000,
                height: 800,
                maximumImageFileSize: 500*1024 // 500KB
            });
            $(".note-editor button.note-btn[data-toggle='dropdown']").each(function (idx, el) {
                $(this).removeAttr('data-toggle').attr('data-bs-toggle', 'dropdown');
            });
        });
    </script>
</div>

<div th:fragment="thumbnail-container(thumbnail)" class="thumbnail-container">
    <img th:src="${#strings.isEmpty(thumbnail) ? '/images/no_image.png' : thumbnail}" class="thumbnail" alt="&times;" />
</div>

<div th:fragment="price-container(product)" class="price-container">
    <div th:if="${product.discountRate == 0}" class="normal-price-view">
        <span th:text="${product.price}" class="price-format"></span>원
    </div>
    <div th:if="${product.discountRate > 0}" class="sale-price-view">
        <div class="before-sale-price"><span class="price-format" th:text="${product.price}"></span>원</div>
        <div class="after-sale-price">
            <span class="discount-rate">[<span th:text="${product.discountRate}"></span>%]</span>
            <span th:text="${product.getDiscountedPrice()}" class="price-format"></span>원
        </div>
    </div>
</div>

<div th:fragment="product-list(productList)" class="row row-cols-lg-3 row-cols-2">
    <div th:each="p : ${productList}" class="col product-card-wrapper" th:data-product-id="${p.id}">
        <div class="card product-card">
            <a th:href="@{'/product/' + ${p.id}}">
                <div class="product-card-thumbnail-container">
                    <img th:src="${#strings.isEmpty(p.thumbnail) ? '/images/no_image.png' : p.thumbnail}" class="product-card-thumbnail" alt="&times;" />
                </div>
                <div class="card-body">
                    <h5 class="card-title" th:text="${p.name}"></h5>
                    <p class="card-text">
                        <div><span th:text="${p.mainCategory}"></span> / <span th:text="${p.subCategory.getName()}"></span></div>
                        <div th:replace="fragments.html :: price-container(product = ${p})"></div>
                        <div>
                            <i class="fa fa-commenting-o" aria-hidden="true"></i> <span th:text="${p.reviewCount}"></span>
                            <button type="button" class="heart">
                                <i class="fa fa-heart-o ps-3" aria-hidden="true"></i>
                                <span th:text="${p.favoritesCount}" class="favorites-count"></span>
                            </button>
                        </div>
                    </p>
                </div>
            </a>
        </div>
    </div>
</div>

<table th:fragment="product-table(mode)" class="table admin-table">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">상품요약</th>
            <th scope="col">평점</th>
            <th scope="col">전체 판매량</th>
            <th scope="col">전체 매출액</th>
            <th scope="col">리뷰수</th>
            <th scope="col">즐겨찾기수</th>
            <th scope="col">게시일</th>
            <th scope="col">최근 수정일</th>
            <th scope="col">수정/삭제</th>
        </tr>
    </thead>
    <tbody th:with="productList=${productPage.getContent()}, offset=${productPage.getNumber() * productPage.getSize()}">
        <tr th:each="p : ${productList}">
            <td scope="row"><span th:text="${offset + pStat.count}"></span></td>
            <td>
                <div class="summary-info-container">
                    <div th:replace="fragments.html :: thumbnail-container(thumbnail = ${p.thumbnail})"></div>
                    <div class="summary-info-wrapper">
                        <div class="summary-info">
                            <span th:text="${p.name}"></span>
                        </div>
                        <div class="summary-info">
                            <span th:text="${p.mainCategory}"></span>-<span th:text="${p.subCategory}"></span>
                        </div>
                        <div class="summary-info">
                            <span class="price-format" th:text="${p.price}"></span>원(<span th:text="${p.discountRate}"></span>%)
                        </div>
                        <div class="summary-info">
                            <span class="price-format" th:text="${p.getDiscountedPrice()}"></span>원
                        </div>
                    </div>
                </div>
            </td>
            <td><span th:text="${#numbers.formatDecimal(p.rank, 1, 2)}"></span></td>
            <td><span th:text="${p.entireSalesQuantity}"></span>개</td>
            <td><span class="price-format" th:text="${p.entireSalesAmount}"></span>원</td>
            <td><span th:text="${p.reviewCount}"></span>개</td>
            <td><span th:text="${p.favoritesCount}"></span>개</td>
            <td><span class="date" th:text="${p.createdDateTime}"></span></td>
            <td><span class="date" th:text="${p.updatedDateTime}"></span></td>
            <td class="option" th:data-product-id="${p.id}">
                <div th:if="${mode == 'view'}" class="admin-btn-group">
                    <a th:href="@{'/admin/management/product/' + ${p.id} + '/update'}" class="admin-update-btn">수정하기</a>
                    <button type="button" class="admin-delete-btn">삭제하기</button>
                </div>
                <div th:if="${mode == 'restore'}" class="admin-btn-group">
                    <button type="button" class="admin-registration-btn">복구하기</button>
                </div>
            </td>
        </tr>
    </tbody>
</table>

<div th:fragment="pagination(page, url, querystring)" th:if="${page.getNumberOfElements() > 0}" class="row justify-content-center" style="margin: 30px 0 50px;">
    <div class="col-md-9">
        <nav>
            <ul class="pagination justify-content-between"
                th:with="start=${page.getNumber() / 10 * 10},
                         end=${T(Math).min(start + 9, page.getTotalPages() - 1)},
                         qs=${querystring == null ? '' : '&' + querystring}">
                <li class="page-item" th:classappend="${!page.hasPrevious()}? disabled">
                    <a class="page-link" th:href="@{|${url}?page=${page.getNumber() - 1}${qs}|}">
                        <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                    </a>
                </li>
                <div class="d-inline-flex justify-content-center">
                    <li class="page-item" th:classappend="${i == page.getNumber()}? active" th:each="i : ${#numbers.sequence(start, end, 1)}">
                        <a class="page-link" th:href="@{|${url}?page=${i}${qs}|}" th:text="${i + 1}"></a>
                    </li>
                </div>
                <li class="page-item" th:classappend="${!page.hasNext()}? disabled">
                    <a class="page-link" th:href="@{|${url}?page=${page.getNumber() + 1}${qs}|}">
                        <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<div th:fragment="backward(url)" class="text-end">
    <a th:href="@{${url}}"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 이전으로</a>
</div>

<form th:fragment="product-form(url, mode)" th:object="${productForm}" th:action="@{${url}}" method="post" class="admin-form" novalidate>
    <div class="form-group">
        <label class="d-block">카테고리</label>
        <select th:field="*{mainCategory}" id="mainCategory" class="form-select">
            <option value="" selected>메인 카테고리</option>
            <option th:each="m : ${T(com.nidas.modules.product.MainCategory).values()}" th:value="${m}" th:text="${m}"></option>
        </select>
        <select th:field="*{subCategory}" id="subCategory" class="form-select">
            <option value="" selected>서브 카테고리</option>
            <option th:each="s : ${T(com.nidas.modules.product.SubCategory).values()}" th:value="${s}" th:text="${s.getName()}"></option>
        </select>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="name">상품명</label>
        <input th:field="*{name}" id="name" type="text" class="form-control" placeholder="상품명을 입력해주세요." />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="price">가격</label>
        <input th:field="*{price}" id="price" type="number" class="form-control" placeholder="가격을 입력해주세요." />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="discountRate">할인율</label>
        <input th:field="*{discountRate}" id="discountRate" type="number" class="form-control" placeholder="할인율을 입력해주세요." value="0" />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="material">재료</label>
        <input th:field="*{material}" id="material" type="text" class="form-control" placeholder="재료를 입력해주세요." maxlength="50" />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="madeIn">생산지</label>
        <input th:field="*{madeIn}" id="madeIn" type="text" class="form-control" placeholder="생산지를 입력해주세요." maxlength="50"/>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="washing">세탁법</label>
        <input th:field="*{washing}" id="washing" type="text" class="form-control" placeholder="세탁법을 입력해주세요." />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="description">설명</label>
        <textarea th:field="*{description}" id="description" class="form-control editor" placeholder="상품 설명을 입력해주세요."></textarea>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="images">이미지</label>
        <input id="images" type="file" class="form-control" multiple aria-describedby="imagesHelp" />
        <small id="imagesHelp" class="form-text text-muted">
            첫 번째 이미지가 썸네일로 지정됩니다.
        </small>
        <div class="image-view"></div>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="details">상품종류</label>
        <div id="details" class="admin-table-wrapper">
            <table class="table admin-table">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">컬러</th>
                    <th scope="col">사이즈(mm)</th>
                    <th scope="col">재고(개)</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td colspan="4">
                        <button type="button" class="admin-add-btn row-addition"></button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary admin-form-btn" th:text="${mode == 'edit' ? '수정하기' : '등록하기'}"></button>
    </div>
</form>

<script th:fragment="phone-format" type="application/javascript">
    $(function () {
        const $phoneFormat = $(".phone-format");
        $phoneFormat.each((idx, el) => {
            let str = el.textContent;
            let pn = str.substring(0, 3) + '-' + str.substring(3, 6);
            if (el.textContent.length === 11) {
                pn = pn.concat(str.substring(6, 7));
            }
            pn = pn.concat('-', str.substring(7));
            $(el).text(pn);
        });
    });
</script>

<form th:fragment="review-form(mode, action)" th:action="${action}" method="post" class="review-form" novalidate>
    <div class="form-group">
        <input type="hidden" class="rank" />
        <div class="star-wrapper">
            <i class="fa fa-star-o"><input type="radio" class="star" /></i>
            <i class="fa fa-star-o"><input type="radio" class="star" /></i>
            <i class="fa fa-star-o"><input type="radio" class="star" /></i>
            <i class="fa fa-star-o"><input type="radio" class="star" /></i>
            <i class="fa fa-star-o"><input type="radio" class="star" /></i>
        </div>
    </div>
    <div class="form-group">
        <textarea class="form-control content" placeholder="상품을 리뷰해주세요.(최소 10자)" maxlength="255"></textarea>
    </div>
    <div class="form-group">
        <input type="file" class="form-control image-file-input" />
        <div class="image-view"></div>
    </div>
    <div class="form-group">
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <button class="btn btn-primary" type="submit" th:text="${mode == 'edit' ? '리뷰수정하기' : '리뷰등록하기'}"></button>
    </div>
</form>

<script th:fragment="review-rank" type="application/javascript">
    $(function () {
        const $star = $(".review-form > .form-group > .star-wrapper > i.fa");

        $star.click(function (event) {
            const $currentRank = $(event.currentTarget).closest(".star-wrapper").siblings("input.rank");
            const $currentStar = $(event.currentTarget).closest(".star-wrapper").find("i.fa");
            const sequence = $currentStar.index(event.currentTarget) + 1;

            $currentRank.val(sequence);
            $currentStar.slice(0, sequence).removeClass("fa-star-o").addClass("fa-star");
            $currentStar.slice(sequence).removeClass("fa-star").addClass("fa-star-o");
        });
    });
</script>

<script th:fragment="review-image" type="application/javascript">
    $(function () {
        const $image = $(".review-form > .form-group > input[type=file].image-file-input");

        $image.change(function (e) {
            const files = $(this)[0].files;
            const $imageView = $(this).siblings(".image-view");
            $imageView.html('');

            if (files.length > 1) {
                $(this).val('');
                alert('하나의 이미지 파일만 업로드할 수 있습니다.');
            } else {
                const file = files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (e.target.result && e.target.result.startsWith("data:image")) {
                        const div = document.createElement("div");
                        const img = document.createElement("img");

                        div.className = 'image-container';
                        div.style.width = '300px';
                        div.style.height = '300px';
                        div.style.overflow = 'hidden';
                        img.className = 'image';
                        img.src = e.target.result;
                        img.style.width = '100%';

                        div.appendChild(img);
                        $imageView.append(div);
                    }
                }
                reader.filename = file.name;
                reader.readAsDataURL(file);
            }
        });
    });
</script>

<div th:fragment="mypage-zoom-image(image)" class="mypage-item-zoom-image-view">
    <div class="mypage-item-zoom-image-container">
        <img th:src="${#strings.isEmpty(image) ? '/images/no_image.png' : image}" class="mypage-item-zoom-image" alt="&times;" />
    </div>
</div>

<nav th:fragment="help-nav(currentMenu)" class="navbar navbar-light help-page-nav">
    <ul class="navbar-nav">
        <li class="nav-item help-page-nav-title">고객센터</li>
        <li class="nav-item">
            <a th:href="@{'/faq-list'}" class="nav-link" th:classappend="${currentMenu == 'faq'}?active">FAQ</a>
        </li>
        <li class="nav-item">
            <a th:href="@{'/notice-list'}" class="nav-link" th:classappend="${currentMenu == 'notice'}?active">공지사항</a>
        </li>
    </ul>
</nav>

<form th:fragment="help-search(action)" th:action="${action}" method="get" class="help-search-form mr-auto">
    <input name="keyword" class="form-control me-2" type="search" placeholder="검색어를 입력해주세요." aria-label="Search2" th:value="${keyword}">
    <button class="btn btn-outline-success" type="submit">Search</button>
</form>

<ul th:fragment="notification-list (notificationList)" class="list-group list-group-flush">
    <a th:each="notification : ${notificationList}" th:href="@{${notification.link}}" class="list-group-item list-group-item-action">
        <div class="d-flex w-100 justify-content-between">
            <small class="text-muted" th:text="${notification.message}"></small>
            <small class="fromNow text-muted" th:text="${notification.createdDateTime}"></small>
        </div>
    </a>
</ul>

<script th:fragment="tooltip" type="application/javascript">
    $(function () {
        $('[data-bs-toggle="tooltip"]').tooltip();
    });
</script>

<form th:fragment="admin-faq-form(url, mode)" th:object="${faqForm}" th:action="@{${url}}" method="post" class="admin-form" novalidate>
    <div class="form-group">
        <label for="type" class="d-block">종류</label>
        <select th:field="*{type}" id="type" class="form-select">
            <option value="" selected>FAQ 종류</option>
            <option th:each="f : ${T(com.nidas.modules.faq.FaqType).values()}" th:value="${f}" th:text="${f.getName()}"></option>
        </select>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="title">제목</label>
        <input th:field="*{title}" id="title" type="text" class="form-control" placeholder="제목을 입력해 주세요." maxlength="100" />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="content">내용</label>
        <textarea th:field="*{content}" id="content" class="form-control editor" placeholder="내용을 입력해 주세요."></textarea>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary admin-form-btn" th:text="${mode == 'edit' ? '수정하기' : '등록하기'}"></button>
    </div>
</form>

<form th:fragment="admin-notice-form(url, mode)" th:object="${noticeForm}" th:action="@{${url}}" method="post" class="admin-form" novalidate>
    <div class="form-group">
        <label for="title">제목</label>
        <input th:field="*{title}" id="title" type="text" class="form-control" placeholder="제목을 입력해 주세요." maxlength="100" />
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <label for="content">내용</label>
        <textarea th:field="*{content}" id="content" class="form-control editor" placeholder="내용을 입력해 주세요."></textarea>
        <small class="invalid-feedback"></small>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary admin-form-btn" th:text="${mode == 'edit' ? '수정하기' : '등록하기'}"></button>
    </div>
</form>